<!DOCTYPE html><html lang="zh-cmn-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Weex 开发新手上路 - (2) 前端避坑篇 · 亦知亦解</title><meta name="description" content="Weex 开发新手上路 - (2) 前端避坑篇 - krimeshu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/gandalfr.css"><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/solarized-light.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.krimeshu.com/atom.xml" title="亦知亦解"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/icon-tech.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="//github.com/krimeshu" target="_self" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Weex 开发新手上路 - (2) 前端避坑篇</h1><div class="tags"><a href="/tags/node-js/" class="tag-title">#node.js</a><a href="/tags/weex/" class="tag-title">#weex</a></div><div class="post-info">May 22, 2019</div><aside id="toc" class="toc-wrap"><h3 class="toc-title">目录</h3><div class="toc-tree"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#页面模板"><span class="toc-text">页面模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#页面样式"><span class="toc-text">页面样式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-仅支持单-class-选择器，不支持样式继承"><span class="toc-text">1. 仅支持单 class 选择器，不支持样式继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-只支持-px-单位，不支持百分比宽高"><span class="toc-text">2. 只支持 px 单位，不支持百分比宽高</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-默认纵向布局，子元素拉伸填充侧轴"><span class="toc-text">3. 默认纵向布局，子元素拉伸填充侧轴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-属性名尽量用全称"><span class="toc-text">4. 属性名尽量用全称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-background-image-不能使用图片资源"><span class="toc-text">5. background-image 不能使用图片资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-多行等分布局问题"><span class="toc-text">6. 多行等分布局问题</span></a></li></ol></li></ol></div></aside><style type="text/css">.toc-wrap {
    float: right;
    padding: 10px 30px 20px 24px;
    margin-bottom: 10px;
    background: #f2f8f2;
}
.toc-title::before {
    content: '#';
    color: #42b983
}
.toc, .toc-child {
    list-style: none;
    padding-left: 20px;
}</style><div class="post-content"><p>接入 WeexSDK 后，前端开发者编写 Weex 页面时会发现，Weex 页面和以前写的 Web 页面还是有一定区别的，一不注意就踩坑了。这里把常见的一些坑列出来，希望能让大家少走弯路：</p>
<a id="more"></a>
<h2 id="页面模板"><a href="#页面模板" class="headerlink" title="页面模板"></a>页面模板</h2><p>页面模板方面，只要注意官方文档内提到哪些组件，以及自己安装的第三方组件，记住只使用这些标签来编写模板即可。</p>
<p>其它经常踩的坑只有一个：文本必须放在 <strong>text</strong> 组件内，<strong>a</strong> 标签内也是如此。且只能使用 Mustache 语法作为节点内容输出，暂不支持 <code>v-text</code> 指令输出。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Wrong --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">"url1"</span>&gt;</span>&#123;&#123;text1&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">"url1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">v-text</span>=<span class="string">"text1"</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Right --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">"url1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;text1&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="页面样式"><a href="#页面样式" class="headerlink" title="页面样式"></a>页面样式</h2><p>样式方面，需要注意的就比较多了。直接当作 CSS 来写，最可能发生的结果就是样式失效白屏。</p>
<p>除了官方文档提到的属性外，还有不少需要留意的地方。</p>
<h3 id="1-仅支持单-class-选择器，不支持样式继承"><a href="#1-仅支持单-class-选择器，不支持样式继承" class="headerlink" title="1. 仅支持单 class 选择器，不支持样式继承"></a>1. 仅支持单 class 选择器，不支持样式继承</h3><p>Weex 样式内不支持标签选择器、属性选择器、ID选择器、后代和子层级选择器、相邻选择器，以及 CSS3 中增加的各种计数选择器等。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="selector-tag">text</span> &#123;</span><br><span class="line">    color: #333333;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[checked]</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#link1</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">a</span>, <span class="selector-class">.header</span> &gt; <span class="selector-tag">p</span>, <span class="selector-class">.icon</span> + <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(0,0,0, 0.05);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说了这么多，其实只需要记住一种：Weex 内目前仅支持 <code>.className</code> 式的类型选择器。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Right */</span></span><br><span class="line"><span class="selector-class">.class1</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(0,0,0,0.05);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.text1</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333333</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>伪类方面，Weex 支持四种伪类：<code>active</code>, <code>focus</code>, <code>disabled</code>, <code>enabled</code>。</p>
<p>所有组件都支持 <code>active</code>, 但只有 <code>input</code> 组件和 <code>textarea</code> 组件支持 <code>focus</code>, <code>enabled</code>, <code>disabled</code>。</p>
<h3 id="2-只支持-px-单位，不支持百分比宽高"><a href="#2-只支持-px-单位，不支持百分比宽高" class="headerlink" title="2. 只支持 px 单位，不支持百分比宽高"></a>2. 只支持 px 单位，不支持百分比宽高</h3><p>根据官方文档的描述，我们知道 Weex 内只能使用像素值单位 <code>px</code>。</p>
<blockquote>
<ul>
<li><p>Weex 不支持类似 <code>em</code>、<code>rem</code>、<code>pt</code>,<code>%</code> 这样的 CSS 标准中的其他长度单位；</p>
</li>
<li><p>单位 <code>px</code> 不可省略，否则在 Web 环境无法正确渲染；</p>
</li>
</ul>
</blockquote>
<p>且这个单位并非真实屏幕像素，而是把所有屏幕视为 <code>750px</code> 宽度，<code>1px</code> 则是<strong>屏幕宽度的七百五十分之一</strong>，而非一个真实像素的宽度，以此来实现不同设备屏幕宽度的适配。</p>
<h3 id="3-默认纵向布局，子元素拉伸填充侧轴"><a href="#3-默认纵向布局，子元素拉伸填充侧轴" class="headerlink" title="3. 默认纵向布局，子元素拉伸填充侧轴"></a>3. 默认纵向布局，子元素拉伸填充侧轴</h3><p>Weex 中支持且仅支持 flexbox 布局方式。但你会发现，在不指定 <code>flex-direction</code> 属性的时候内部元素是纵向布局的。</p>
<p>因为 Weex 中默认 <code>flex-direction</code> 为 <code>column</code> 而不是 <code>row</code>。</p>
<p>而且不设置子元素的宽度，父元素的 <code>align-items</code> 为默认的 <code>stretch</code> 时，子元素将自动拉伸填充侧轴宽度。</p>
<img src="/images/start-journy-to-the-weex/flex-direction-and-stretch.png" title="cover">
<p>由于 Weex 不支持 <code>%</code> 单位，某个组件需要适配父组件宽度的时候，可以通过这个方式实现宽度 <code>100%</code> 的效果。</p>
<h3 id="4-属性名尽量用全称"><a href="#4-属性名尽量用全称" class="headerlink" title="4. 属性名尽量用全称"></a>4. 属性名尽量用全称</h3><p>在完成本文章时，使用 Weex 版本 <code>v1.3.11</code> 测试以下样式写法的情况如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.t1</span> &#123;   <span class="comment">/* 有效 */</span></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.t2</span> &#123;   <span class="comment">/* 无效 */</span></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.t3</span> &#123;   <span class="comment">/* 有效 */</span></span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.t4</span> &#123;   <span class="comment">/* 无效 */</span></span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.t5</span> &#123;   <span class="comment">/* 有效 */</span></span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">border-style</span>: solid;</span><br><span class="line">    <span class="attribute">border-color</span>: blue;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">border-top-width</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">border-top-style</span>: dashed;</span><br><span class="line">    <span class="attribute">border-top-color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.t6</span> &#123;   <span class="comment">/* 无效 */</span></span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.t7</span> &#123;   <span class="comment">/* 有效 */</span></span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，使用简写形式书写的样式，Weex 不一定支持，所以在 Weex 内尽量使用全称的样式，以免失效。</p>
<h3 id="5-background-image-不能使用图片资源"><a href="#5-background-image-不能使用图片资源" class="headerlink" title="5. background-image 不能使用图片资源"></a>5. background-image 不能使用图片资源</h3><p>尝试在 Weex 内使用 <code>background-image</code> 样式引入图片，然而并没有效果，官方文档内此属性也只用来实现背景色渐变。</p>
<p>看来 Weex 内应该是只能 <code>image</code> 组件展示图片资源了。</p>
<h3 id="6-多行等分布局问题"><a href="#6-多行等分布局问题" class="headerlink" title="6. 多行等分布局问题"></a>6. 多行等分布局问题</h3><p>之前说过，默认子元素侧轴拉伸对齐的情况下，不设置子元素宽度即可实现宽度 <code>100%</code> 的适配。</p>
<p>如果子元素需要等分父元素宽度，只要使他们的 <code>flex-grow</code> 权重一致即可，但这个适配方案只能处理单行的情况。</p>
<p>对于 Web 页面 flex 多行布局的情况，我们给父元素设置 <code>flex-wrap: wrap;</code> 属性后，通常根据每行子元素数量设定子元素宽度的百分比。如每行两个子元素时，就给它们设置 <code>width: 50%;</code>。</p>
<p>但之前说过，Weex 内不支持百分比单位，而 <code>flex-grow</code> 达不到这样的效果。</p>
<p>所以只能假定，父元素一定是占满屏幕宽度，子元素根据 <code>750px/n</code> 来设置宽度。或者从父组件，通过属性传递告知子组件宽度，再对子组件内的子元素进行宽度计算适配，流程较复杂，且样式部分耦合到了脚本逻辑内。</p>
<p>目前暂时没有想到更好的方案，只能假定父元素一定是 <code>750px</code> 宽度处理，日常业务一般也是这样的情况，只能保持警惕，遇到这样的情况时注意适配了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/05/24/webstorm-detect-webpack-alias-config/" class="prev">PREV</a><a href="/2019/03/22/start-journy-to-the-weex-0/" class="next">NEXT</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNDQzMi8xMDk2OQ=="></div><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script><div class="copyright"><p>© 2017 - 2020 <a href="http://blog.krimeshu.com">krimeshu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/MikeCoder/hexo-theme-gandalfr" target="_blank">hexo-theme-gandalfr</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261274049'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1261274049%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></p></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" crossorigin="anonymous"></script><script src="//cdn.bootcss.com/jquery/3.1.1/jquery.js" crossorigin="anonymous"></script><script>$(document).ready(function() { $('pre').each(function(i, block) { hljs.highlightBlock(block); }); });</script></body></html>